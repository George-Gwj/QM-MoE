# Joint3 摆动课程学习

## 概述

本环境实现了专门针对 `joint3` 的摆动控制，通过课程学习逐步增加摆动的幅度和频率，帮助机器人学习在移动过程中保持机械臂的稳定性。

## 课程学习阶段

### 阶段1：基础训练
- **描述**：不进行机械臂摆动，专注于腿部运动控制
- **目标**：让机器人学会基本的移动技能
- **持续时间**：前 100万步

### 阶段2：小幅度摆动
- **描述**：启用 joint3 摆动，小幅度 ±0.2rad，低频率 0.5Hz
- **目标**：开始学习在移动过程中控制机械臂
- **持续时间**：100万 - 200万步

### 阶段3：中等幅度摆动
- **描述**：增加摆动幅度到 ±0.5rad，保持低频率 0.5Hz
- **目标**：提高机械臂控制的稳定性
- **持续时间**：200万 - 300万步

### 阶段4：大幅度摆动
- **描述**：进一步增加摆动幅度到 ±1.0rad，保持低频率 0.5Hz
- **目标**：在较大摆动下保持平衡
- **持续时间**：300万 - 400万步

### 阶段5：中等频率摆动
- **描述**：保持大幅度 ±1.0rad，增加频率到 1.0Hz
- **目标**：学习快速响应机械臂运动
- **持续时间**：400万 - 500万步

### 阶段6：最大挑战
- **描述**：最大摆动幅度 ±2.0rad，高频率 1.5Hz
- **目标**：在极限条件下保持稳定
- **持续时间**：500万步以后

## 配置参数

### 课程学习参数
```yaml
curriculum:
  stage: 1                    # 起始阶段
  transition_steps: 1000000   # 阶段转换步数
  joint3_swing_amplitude: 0.5 # 默认摆动幅度
  joint3_swing_frequency: 1.0 # 默认摆动频率
  joint3_swing_enabled: false # 默认不启用摆动
```

### 机械臂控制参数
```yaml
arm_control:
  kp: 100.0  # 位置增益
  kd: 1.0    # 速度增益
```

### 奖励配置
```yaml
rewards:
  base_cmd_tracking_sigma: 0.5
  base_cmd_tracking_reward_scale: 1.0
```

## 使用方法

### 1. 使用配置文件
```bash
python scripts/train.py --config-name=combo_go2Piper_velcmd_arm_swing_joint3
```

### 2. 自定义配置
可以修改配置文件中的参数来调整课程学习：
- `transition_steps`：调整每个阶段的持续时间
- `joint3_swing_amplitude`：调整摆动幅度
- `joint3_swing_frequency`：调整摆动频率

### 3. 监控训练进度
训练过程中会输出课程学习阶段的转换信息：
```
课程学习：进入阶段2 - 启用joint3摆动（小幅度±0.2rad，低频率0.5Hz）
课程学习：进入阶段3 - 增加joint3摆动幅度（±0.5rad，频率0.5Hz）
...
```

## 技术实现

### 摆动控制
- 使用正弦函数生成摆动轨迹：`target = init_pos + amplitude * sin(2π * frequency * time)`
- 通过PD控制器计算控制力矩
- 考虑关节软限位，确保摆动在安全范围内

### 课程学习
- 基于全局步数自动转换阶段
- 每个阶段调整摆动幅度和频率
- 保持训练连续性，避免突变

### 安全性
- 摆动幅度在关节软限位范围内
- 可配置的PD控制参数
- 渐进式难度增加

## 注意事项

1. **关节识别**：系统会自动识别 `joint3`，如果找不到会尝试其他命名方式
2. **时间同步**：摆动时间在每个环境重置时重置，确保一致性
3. **性能监控**：建议监控关节力矩和位置，确保控制稳定性
4. **参数调优**：根据具体机器人调整PD参数和摆动参数

## 故障排除

### 找不到 joint3
- 检查URDF文件中的关节命名
- 确认 `dof_names` 属性是否正确设置

### 摆动不稳定
- 调整PD控制参数（kp, kd）
- 降低摆动幅度和频率
- 检查关节限位设置

### 训练不收敛
- 延长每个阶段的训练时间
- 调整奖励权重
- 检查约束条件设置 