# 课程学习阶段6：三关节摆动控制

## 概述
在原有的课程学习基础上，新增了第6个学习阶段，实现了从单关节摆动控制升级为三关节摆动控制的功能。

## 课程学习阶段说明

### 阶段1：基础训练
- 不做机械臂目标，专注于腿部运动控制
- 为后续机械臂控制打下基础

### 阶段2：机械臂随机目标
- 启用机械臂随机目标（不摆动）
- 开始引入机械臂控制任务

### 阶段3：小幅度摆动
- 启用机械臂摆动，幅度为 ±0.3rad
- 学习基本的摆动控制

### 阶段4：中等幅度摆动
- 加大摆动幅度至 ±0.8rad
- 提高摆动控制的挑战性

### 阶段5：大幅度摆动
- 摆动幅度提升至 ±1.5rad
- 训练大幅摆动的控制能力

### 阶段6：三关节摆动控制 ⭐ 新增
- **核心特性**：从单关节控制升级为三关节同时控制
- **摆动幅度**：每个关节有不同的摆动幅度
  - 关节1：小幅度摆动 ±0.5rad
  - 关节2：中等幅度摆动 ±1.0rad  
  - 关节3：大幅度摆动 ±1.5rad
- **控制复杂度**：显著提高控制难度，训练多关节协调能力

## 技术实现

### 1. 课程阶段更新
```python
elif self.curriculum_stage == 5 and global_step >= self.curriculum_transition_steps * 5:
    # 阶段5 -> 阶段6：从单关节摆动升级为三关节摆动
    self.curriculum_stage = 6
    self.arm_swing_amplitude = 2.0  # 稍微降低幅度，因为控制三个关节更复杂
    logging.info("课程学习：进入阶段6 - 升级为三关节摆动控制")
```

### 2. 摆动偏移生成
阶段6为三个关节分别生成不同幅度的摆动偏移：
```python
elif self.curriculum_stage == 6:
    # 阶段6：三关节摆动，每个关节有不同的摆动幅度
    offsets = torch.zeros((num_envs, 3), device=device)
    # 第一个关节：小幅度摆动 ±0.5rad
    offsets[:, 0] = (torch.rand((num_envs,), device=device, generator=self.generator) - 0.5) * 1.0
    # 第二个关节：中等幅度摆动 ±1.0rad
    offsets[:, 1] = (torch.rand((num_envs,), device=device, generator=self.generator) - 0.5) * 2.0
    # 第三个关节：大幅度摆动 ±1.5rad
    offsets[:, 2] = (torch.rand((num_envs,), device=device, generator=self.generator) - 0.5) * 3.0
```

### 3. 关节选择策略
在reset时根据课程阶段选择不同数量的关节：
```python
if self.curriculum_stage == 6:
    # 阶段6：选择三个关节进行摆动控制
    # 随机选择三个不同的关节索引
else:
    # 其他阶段：选择单个关节进行摆动控制
    # 随机选择一个关节索引
```

### 4. 多关节控制逻辑
阶段6实现了完整的三关节控制流程：
- 目标计算：为三个关节分别计算目标位置
- 限位检查：确保每个关节的目标在软限位范围内
- PD控制：为三个关节分别计算控制力矩
- 力矩应用：将三个关节的力矩同时应用到系统中

## 训练优势

1. **渐进式学习**：从单关节到多关节，逐步提高控制复杂度
2. **协调能力训练**：训练机器人同时控制多个关节的协调能力
3. **稳定性提升**：在reset时确定关节选择，提高训练稳定性
4. **实际应用性**：更接近实际应用中的多关节协调控制需求

## 配置参数

可以通过配置文件调整以下参数：
- `curriculum.stage`：当前课程阶段
- `curriculum.transition_steps`：阶段转换步数
- `curriculum.arm_swing_amplitude`：摆动幅度（阶段6中会被覆盖）
- `arm_control.kp`：PD控制的比例增益
- `arm_control.kd`：PD控制的微分增益

## 使用建议

1. **训练时间**：阶段6需要更长的训练时间，因为控制复杂度显著提高
2. **参数调优**：可能需要调整PD控制参数以适应多关节控制
3. **监控指标**：关注三个关节的跟踪误差和协调性指标
4. **阶段转换**：确保在进入阶段6之前，单关节控制已经收敛 